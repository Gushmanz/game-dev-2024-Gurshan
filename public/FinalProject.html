<h6> Version 0.0.1 </h6>

<body id="myBody" style="background-repeat:repeat; background-size: 80%" background="myBackground01.jpg" onkeydown="gameControl(event)">

<h1 align=center>Platformer Game by Fred</h1>
<br><br><br><br>

<script>

   // global variables here
   let playerX = 50; // Player's X position
   let playerY = 300; // Player's Y position (initial ground level)
   let velocityY = 0; // Vertical velocity for jumping and falling
   let gravity = 1;   // Gravity pulling the player down
   let moveSpeed = 7; // Horizontal movement speed
   let jumpPower = -15; // Jump power
   let isJumping = false; // To check if the player is in the air
   let isOnGround = false; // To check if the player is on the ground
   let platformHeight = 20; // Height of the platforms

   // Platforms positions (x, y, width, height)
   let platforms = [
     { x: 50, y: 400, width: 200, height: platformHeight },
     { x: 300, y: 350, width: 200, height: platformHeight },
     { x: 600, y: 300, width: 200, height: platformHeight },
     { x: 900, y: 250, width: 200, height: platformHeight }
   ];

   let player = document.getElementById('myImg01'); // Player element
   let myInterval = 0; // To hold interval ID for future use

   // Function to handle key press events (W, A, S, D)
   function gameControl(event) {
      let key = event.key.toLowerCase(); // Normalize key input
      if (key === 'd') {
         movePlayer('right');
      } else if (key === 'a') {
         movePlayer('left');
      } else if (key === 'w' && !isJumping && isOnGround) {
         jump();
      }
   }

   // Function to move the player
   function movePlayer(direction) {
      if (direction === 'right') {
         playerX += moveSpeed;
      } else if (direction === 'left') {
         playerX -= moveSpeed;
      }
      // Update player position on screen
      player.style.left = playerX + 'px';
   }

   // Function to make the player jump
   function jump() {
      isJumping = true;
      velocityY = jumpPower;
   }

   // Check if player is colliding with any platforms
   function myHitOther(my1, my2) {
      let left1 = parseInt(document.getElementById(my1).style.left);
      let right1 = left1 + parseInt(document.getElementById(my1).style.width);
      let top1 = parseInt(document.getElementById(my1).style.top);
      let bottom1 = top1 + parseInt(document.getElementById(my1).style.height);
      
      let left2 = parseInt(document.getElementById(my2).style.left);
      let right2 = left2 + parseInt(document.getElementById(my2).style.width);
      let top2 = parseInt(document.getElementById(my2).style.top);
      let bottom2 = top2 + parseInt(document.getElementById(my2).style.height);
      
      if ((right1 >= left2) && (bottom1 >= top2) && (left1 <= right2) && (top1 <= bottom2)) {
         return true;
      }
   }

   // Update player position with gravity and handle jumping
   function updatePlayerPosition() {
      if (isJumping) {
         playerY += velocityY; // Apply vertical velocity
         velocityY += gravity; // Apply gravity
      }

      // Check if player is on a platform
      isOnGround = false;
      platforms.forEach(platform => {
         if (
            playerX + player.offsetWidth > platform.x &&
            playerX < platform.x + platform.width &&
            playerY + player.offsetHeight <= platform.y + gravity &&
            playerY + player.offsetHeight >= platform.y
         ) {
            playerY = platform.y - player.offsetHeight; // Set player on top of platform
            velocityY = 0; // Stop falling
            isJumping = false; // Player is no longer jumping
            isOnGround = true; // Player is on the ground
         }
      });

      // If player is not on any platform, they keep falling
      if (!isOnGround) {
         playerY += gravity;
      }

      // Prevent the player from falling below the ground
      if (playerY > 400) {
         playerY = 400;
         isJumping = false;
         isOnGround = true;
      }

      // Update player position
      player.style.top = playerY + 'px';
   }

   // Main game loop (called continuously to update player position)
   function gameLoop() {
      updatePlayerPosition();
      myCheckHit(); // Check for collisions (e.g., player vs enemy)
   }

   // Start the game loop
   setInterval(gameLoop, 20);

   // Collision check for the player
   function myCheckHit() {
      if (myHitOther('myImg01', 'myImg02')) {
         alert('You Lose!');  
         document.getElementById('myImg01').style.left = '20px';
         location = 't2a13-keydown.html'; // Go to the next level
      }
   }
</script>

<!-- Player and Platforms -->
<img id="myImg01" style="position:absolute; width:100px; height:80px; top:300px; left:50px;" src="myImage01.jpg">
<div id="platform1" style="position:absolute; width:200px; height:20px; background-color: #008CBA; top:400px; left:50px;"></div>
<div id="platform2" style="position:absolute; width:200px; height:20px; background-color: #008CBA; top:350px; left:300px;"></div>
<div id="platform3" style="position:absolute; width:200px; height:20px; background-color: #008CBA; top:300px; left:600px;"></div>
<div id="platform4" style="position:absolute; width:200px; height:20px; background-color: #008CBA; top:250px; left:900px;"></div>

<input type=button value="Auto Background Left" onclick="{
   clearInterval(myClock)
   let myTemp = '100px 0px'
   myClock = setInterval(function(){
      myGlobalX -= 5
      myTemp =  myGlobalX + 'px 0px'
      document.getElementById('myBody').style.backgroundPosition = myTemp
   }, 100)
}">

<input type=button value="Image Right Fast Button" onTouchStart="{this.click(); event.preventDefault();}" onclick="{
   document.getElementById('myImg01').style.left = parseInt(document.getElementById('myImg01').style.left) + 10 + 'px';
   myCheckHit(); // Check for collisions
}"><br><br>

<div id="myDiv01" style="color:yellow">Use WASD to move the player and jump with W!</div>

</body>
